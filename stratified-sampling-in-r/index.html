<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Stratified sampling in R &#8211; Spencer Boucher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Spencer Boucher">
    <meta name="keywords" content="">
    <link rel="canonical" href="http://spencerboucher.com/stratified-sampling-in-r/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Spencer Boucher" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201601301838" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    

    <!-- MathJax -->
    
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <!-- Verifications -->
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Stratified sampling in R">
    <meta property="og:description" content="">
    <meta property="og:url" content="http://spencerboucher.com/stratified-sampling-in-r/">
    <meta property="og:site_name" content="Spencer Boucher">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@justmytwospence" />
    
    <meta name="twitter:title" content="Stratified sampling in R" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:url" content="http://spencerboucher.com/stratified-sampling-in-r/" />

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-45101202-1', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>

<body class="site animated fade-in-down">

	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://spencerboucher.com" class="site-title">Spencer Boucher</a>
      <nav class="site-nav">
        
    

    
        <a href="/about/">About</a>
    

    

    

    

    

    

    

    

    


    

    

    
        <a href="/contact/">Contact</a>
    

    

    

    

    

    

    

    


      </nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>Stratified sampling in R</h1>
  <span class="post-meta">January 10, 2014</span><br>
  
  <span class="post-meta small">
  
    1 minute read
  
  </span>
</div>

<article class="post-content">
  <p>I was surprised to find that R doesn’t have a base function for stratified
random sampling. There’s not even a well known package I could find that does
this in a straight forward way. So heres my own.</p>

<p>It is essentially a wrapper for a ddply call that samples each subset and then
combines them. If the size argument is less than 1, it will be interpreted as
the percentage of each stratification subset that should be sampled. If the size
argument is greater than 1, it will be interpreted as the number of observations
to sample from each stratification subset.</p>

<p>Note that in the first case, a different number of observations will be taken
from each subset depending on their total number of observations. In the second
case however, an equal number of observations will be sampled from each subset,
regardless of their total number of observations.</p>

<p>The .by argument is formulated the same way it is for any other ddply call.</p>
<div class="highlight"><pre><code class="language-R" data-lang="R"><span class="n">stratified_sample</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">.5</span><span class="p">,</span> <span class="n">.by</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="m">37L</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">require</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span>
  <span class="n">set.seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
  <span class="n">df.sample</span> <span class="o">&lt;-</span> <span class="n">ddply</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">.by</span><span class="p">,</span>
                     <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
                       <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&lt;</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">size</span> <span class="o">&lt;-</span> <span class="n">size</span> <span class="o">*</span> <span class="n">nrow</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
                       <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">),])</span>
                     <span class="p">},</span>
                     <span class="n">.progress</span> <span class="o">=</span> <span class="s1">'text'</span><span class="p">)</span>
  <span class="k">return</span><span class="p">(</span><span class="n">df.sample</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</article>




  <div class="py2 post-footer">
  <img src="/images/avatar.jpg" alt="Spencer Boucher" class="avatar" />
  <p>
    Spencer is a data scientist living in San Francisco, California.
  </p>
  <p>
    The source code for this post can be found <a href="https://github.com/justmytwospence/pixyll/tree/master/_posts/2014-01-10-stratified-sampling-in-r.md">here</a>.
  </p>
</div>




  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'justmytwospence';
    var disqus_identifier = '/stratified-sampling-in-r';
    var disqus_title      = 'Stratified sampling in R';

    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <small>
      Built with jekyll, github-pages, and <a href="https://github.com/johnotander/pixyll">Pixyll</a>.
    </small>
  </div>
</footer>

</body>
</html>
